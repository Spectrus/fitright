<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Lifestyle AI Moodboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .ai-badge {
            display: inline-block;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(231, 76, 60, 0.3);
        }

        /* Search Section */
        .search-container {
            max-width: 700px;
            margin: 0 auto;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 18px 25px;
            font-size: 1.1rem;
            border: none;
            border-radius: 30px;
            background: rgba(255,255,255,0.95);
            color: #333;
            box-shadow: 0 6px 25px rgba(0,0,0,0.3);
            outline: none;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        }

        .search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 22px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            transform: translateY(-50%) scale(1.05);
        }

        /* AI Controls */
        .ai-controls {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .ai-filter {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .ai-filter:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }

        .ai-filter input[type="range"] {
            width: 120px;
        }

        .ai-filter label {
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* Suggestions */
        .suggestions {
            margin: 30px auto;
            max-width: 1200px;
            padding: 0 20px;
        }

        .suggestions h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #ecf0f1;
            font-size: 1.3rem;
            font-weight: 300;
        }

        .suggestion-tags {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
        }

        .suggestion-tag {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            color: #ecf0f1;
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.2);
            font-weight: 500;
        }

        .suggestion-tag:hover {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(44, 62, 80, 0.4);
        }

        /* Status Messages */
        .status {
            text-align: center;
            margin: 20px;
            padding: 18px;
            border-radius: 15px;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        .status.loading {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid rgba(52, 152, 219, 0.3);
            color: #3498db;
        }

        .status.error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .status.success {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid rgba(46, 204, 113, 0.3);
            color: #2ecc71;
        }

        /* Masonry Grid */
        .masonry-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .masonry-grid {
            columns: 1;
            column-gap: 20px;
            margin-top: 20px;
        }

        @media (min-width: 480px) {
            .masonry-grid { columns: 2; }
        }

        @media (min-width: 768px) {
            .masonry-grid { columns: 3; }
        }

        @media (min-width: 1024px) {
            .masonry-grid { columns: 4; }
        }

        @media (min-width: 1200px) {
            .masonry-grid { columns: 5; }
        }

        /* AI-Enhanced Cards */
        .pin-card {
            break-inside: avoid;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
        }

        .pin-card.high-priority {
            border-color: rgba(231, 76, 60, 0.5);
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.2);
        }

        .pin-card.medium-priority {
            border-color: rgba(241, 196, 15, 0.5);
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.2);
        }

        .pin-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border-color: rgba(255,255,255,0.2);
        }

        .pin-image {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.4s ease;
        }

        .pin-card:hover .pin-image {
            transform: scale(1.05);
        }

        .pin-info {
            padding: 18px;
        }

        .pin-title {
            font-weight: 600;
            font-size: 1rem;
            color: #ecf0f1;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .pin-author {
            color: #bdc3c7;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 12px;
        }

        .pin-author a {
            color: #3498db;
            text-decoration: none;
        }

        .pin-author a:hover {
            text-decoration: underline;
        }

        /* AI Score Display */
        .ai-score {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(231, 76, 60, 0.4);
        }

        .ai-score.high { background: linear-gradient(135deg, #27ae60 0%, #229954 100%); }
        .ai-score.medium { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); }
        .ai-score.low { background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%); }

        .source-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .source-badge.pexels {
            background: linear-gradient(135deg, #05A081 0%, #04916B 100%);
        }

        .source-badge.unsplash {
            background: linear-gradient(135deg, #000 0%, #333 100%);
        }

        .source-badge.reddit {
            background: linear-gradient(135deg, #FF4500 0%, #FF5722 100%);
        }

        .ai-analysis {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            margin-top: 10px;
            border-radius: 10px;
            font-size: 0.85rem;
        }

        .ai-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .ai-tag {
            background: rgba(52, 152, 219, 0.3);
            color: #3498db;
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        /* Load More Button */
        .load-more-container {
            text-align: center;
            margin: 50px 0;
        }

        .load-more-btn {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 25px rgba(44, 62, 80, 0.3);
        }

        .load-more-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(44, 62, 80, 0.4);
        }

        .load-more-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Image Counter */
        .image-counter {
            text-align: center;
            margin: 25px 0;
            font-size: 1.1rem;
            color: #bdc3c7;
            font-weight: 500;
        }

        /* Loading Animation */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Priority Indicator */
        .priority-indicator {
            position: absolute;
            top: 50px;
            right: 12px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .priority-indicator.high { background: #27ae60; }
        .priority-indicator.medium { background: #f39c12; }
        .priority-indicator.low { background: #95a5a6; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .search-box {
                font-size: 1rem;
                padding: 15px 20px;
            }
            
            .ai-controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="ai-badge">üß† AI-Powered Smart Prioritization + Anti-Artificial Background</div>
        <h1>Executive Lifestyle AI Moodboard</h1>
        <p class="subtitle">Search anything - AI prioritizes executive, sophisticated & powerful imagery while filtering artificial backgrounds</p>
        
        <div class="search-container">
            <input type="text" class="search-box" id="searchInput" placeholder="Search for anything - cats, cars, food, travel..." />
            <button class="search-btn" onclick="searchImages()">üîç Search</button>
        </div>
    </div>

    <div class="ai-controls">
        <div class="ai-filter">
            <label for="executiveScore">Executive Priority:</label>
            <input type="range" id="executiveScore" min="0" max="100" value="30">
            <span id="executiveValue">30%</span>
        </div>
        <div class="ai-filter">
            <label for="vintageScore">Vintage Boost:</label>
            <input type="range" id="vintageScore" min="0" max="100" value="20">
            <span id="vintageValue">20%</span>
        </div>
        <div class="ai-filter">
            <label for="powerScore">Power Symbols:</label>
            <input type="range" id="powerScore" min="0" max="100" value="20">
            <span id="powerValue">20%</span>
        </div>
        <div class="ai-filter">
            <label for="sceneryScore">Scenery Authenticity:</label>
            <input type="range" id="sceneryScore" min="0" max="100" value="20">
            <span id="sceneryValue">20%</span>
        </div>
        <div class="ai-filter">
            <label for="artificialScore">Anti-Artificial Background:</label>
            <input type="range" id="artificialScore" min="0" max="100" value="20">
            <span id="artificialValue">20%</span>
        </div>
    </div>

    <div class="suggestions">
        <h3>‚ú® Try These Searches</h3>
        <div class="suggestion-tags">
            <span class="suggestion-tag" onclick="searchSuggestion('cats')">üê± Cats</span>
            <span class="suggestion-tag" onclick="searchSuggestion('coffee')">‚òï Coffee</span>
            <span class="suggestion-tag" onclick="searchSuggestion('cars')">üöó Cars</span>
            <span class="suggestion-tag" onclick="searchSuggestion('travel')">‚úàÔ∏è Travel</span>
            <span class="suggestion-tag" onclick="searchSuggestion('food')">üçΩÔ∏è Food</span>
            <span class="suggestion-tag" onclick="searchSuggestion('architecture')">üèõÔ∏è Architecture</span>
            <span class="suggestion-tag" onclick="searchSuggestion('business')">üíº Business</span>
            <span class="suggestion-tag" onclick="searchSuggestion('fashion')">üëî Fashion</span>
        </div>
    </div>

    <div id="statusMessage" class="status" style="display: none;"></div>
    <div id="imageCounter" class="image-counter" style="display: none;"></div>

    <div class="masonry-container">
        <div id="masonryGrid" class="masonry-grid"></div>
    </div>

    <div class="load-more-container">
        <button id="loadMoreBtn" class="load-more-btn" onclick="loadMoreImages()" style="display: none;">
            Load More Images
        </button>
    </div>

    <script>
        // API Configuration
        const PEXELS_API_KEY = 'PQZyJwis9y616BtkH3lbZrDiJXDU5Vlq4gmsTJQDiRIVO8BE0W1rW7mk';
        const UNSPLASH_ACCESS_KEY = '9IC3qF1KqCRtg64nKKK4aRbrdbxb0GpyfPBl3kwGhew';
        
        const PEXELS_API_URL = 'https://api.pexels.com/v1/search';
        const UNSPLASH_API_URL = 'https://api.unsplash.com/search/photos';
        
        // Reddit Configuration
        const REDDIT_SUBREDDITS = [
            'https://www.reddit.com/r/style/search.json',
            'https://www.reddit.com/r/oldschoolcool/search.json'
        ];
        
        // Global variables
        let currentQuery = '';
        let currentPage = 1;
        let totalImages = 0;
        let isLoading = false;

        // Enhanced AI Classification System with Anti-Fake Scene Detection
        class ExecutiveAI {
            constructor() {
                // Executive keywords
                this.executiveKeywords = [
                    'executive', 'businessman', 'suit', 'tie', 'office', 'boardroom',
                    'meeting', 'handshake', 'corporate', 'professional', 'ceo', 'boss',
                    'vintage', 'classic', 'timeless', 'sophisticated', 'elegant',
                    'gentleman', 'distinguished', 'refined', 'heritage'
                ];
                
                // Vintage keywords
                this.vintageKeywords = [
                    'vintage', 'classic', 'retro', 'antique', 'old', 'traditional',
                    'heritage', 'timeless', 'historical', 'nostalgic', 'aged',
                    'weathered', 'patina', 'worn', 'faded', 'sepia'
                ];
                
                // Power symbols
                this.powerKeywords = [
                    'luxury', 'expensive', 'premium', 'exclusive', 'elite',
                    'powerful', 'dominant', 'authority', 'control', 'command',
                    'wealth', 'rich', 'opulent', 'lavish', 'extravagant'
                ];

                // FAKE SCENE indicators (from anti-fake scene AI)
                this.fakeSceneMarkers = [
                    // Studio/artificial environments
                    'white background', 'studio', 'backdrop', 'seamless background',
                    'isolated', 'cutout', 'plain background', 'neutral background',
                    
                    // Overly staged/posed
                    'posed', 'modeling', 'fashion shoot', 'portrait session',
                    'professional photography', 'studio lighting', 'softbox',
                    
                    // Theatrical/costume elements
                    'costume', 'theatrical', 'dramatic pose', 'staged',
                    'prop', 'artificial', 'fake', 'imitation',
                    
                    // Too perfect/artificial
                    'perfect lighting', 'flawless', 'airbrushed', 'retouched',
                    'instagram', 'influencer', 'selfie', 'social media'
                ];

                // ARTIFICIAL BACKGROUND indicators (specific for white/artificial backgrounds)
                this.artificialBackgroundMarkers = [
                    'white background', 'plain white', 'studio background', 'seamless white',
                    'isolated background', 'clean background', 'neutral background',
                    'white backdrop', 'studio shot', 'cutout', 'isolated', 'plain background',
                    'artificial background', 'fake background', 'edited background',
                    'removed background', 'transparent background', 'solid background'
                ];
                
                // AUTHENTIC SCENE indicators
                this.authenticSceneMarkers = [
                    // Real environments
                    'office', 'boardroom', 'meeting room', 'conference room',
                    'restaurant', 'cafe', 'hotel lobby', 'library',
                    'street', 'outdoor', 'natural light', 'window light',
                    
                    // Real activities
                    'working', 'meeting', 'conversation', 'reading',
                    'walking', 'driving', 'business', 'professional',
                    
                    // Candid/documentary style
                    'candid', 'natural', 'documentary', 'reportage',
                    'lifestyle', 'real life', 'authentic', 'genuine',
                    
                    // Vintage authenticity
                    'vintage', 'classic', 'retro', 'historical',
                    'black and white', 'film grain', 'analog'
                ];
                
                // Safety filter
                this.unsafeContent = [
                    'explicit', 'nude', 'naked', 'nsfw', 'porn',
                    'violence', 'blood', 'gore', 'weapon'
                ];
            }
            
            analyzeImage(image, source) {
                const description = this.getImageDescription(image, source).toLowerCase();
                
                // Safety check first
                const safetyScore = this.calculateSafetyScore(description);
                if (safetyScore < 0.3) {
                    return null; // Block unsafe content
                }
                
                // Calculate all scores
                const executiveScore = this.calculateExecutiveScore(description);
                const vintageScore = this.calculateVintageScore(description);
                const powerScore = this.calculatePowerScore(description);
                
                // Anti-fake scene scoring
                const fakeSceneScore = this.calculateFakeSceneScore(description);
                const authenticSceneScore = this.calculateAuthenticSceneScore(description);
                const sceneryScore = Math.max(0, authenticSceneScore - (fakeSceneScore * 0.5));
                
                // NEW: Artificial background scoring
                const artificialBackgroundScore = this.calculateArtificialBackgroundScore(description);
                const artificialScore = Math.max(0, 1 - artificialBackgroundScore); // Invert so higher = better (less artificial)
                
                // MODIFIED FINAL SCORE CALCULATION WITH ARTIFICIAL BACKGROUND WEIGHT 0.2
                // Adjusted other weights to accommodate artificialScore
                const finalScore = (executiveScore * 0.25) + (vintageScore * 0.2) + (powerScore * 0.2) + (sceneryScore * 0.15) + (artificialScore * 0.2);
                
                return {
                    executiveScore,
                    vintageScore,
                    powerScore,
                    sceneryScore,
                    artificialScore,
                    artificialBackgroundScore,
                    fakeSceneScore,
                    authenticSceneScore,
                    finalScore,
                    priority: this.determinePriority(finalScore),
                    tags: this.generateTags(description),
                    safetyScore
                };
            }
            
            getImageDescription(image, source) {
                if (source === 'pexels') {
                    return `${image.alt || ''} ${image.photographer || ''}`;
                } else if (source === 'unsplash') {
                    return `${image.alt_description || ''} ${image.description || ''} ${image.user?.name || ''}`;
                } else if (source === 'reddit') {
                    return `${image.title || ''} ${image.author || ''}`;
                }
                return '';
            }
            
            getPhotographerName(image, source) {
                if (source === 'pexels') {
                    return image.photographer || '';
                } else if (source === 'unsplash') {
                    return image.user?.name || '';
                } else if (source === 'reddit') {
                    return image.author || '';
                }
                return '';
            }
            
            calculateSafetyScore(description) {
                let penalties = 0;
                this.unsafeContent.forEach(keyword => {
                    if (description.includes(keyword)) {
                        penalties += 0.5;
                    }
                });
                return Math.max(0, 1 - penalties);
            }
            
            calculateExecutiveScore(description) {
                let score = 0;
                this.executiveKeywords.forEach(keyword => {
                    if (description.includes(keyword)) {
                        score += 0.1;
                    }
                });
                return Math.min(1, score);
            }
            
            calculateVintageScore(description) {
                let score = 0;
                this.vintageKeywords.forEach(keyword => {
                    if (description.includes(keyword)) {
                        score += 0.1;
                    }
                });
                return Math.min(1, score);
            }
            
            calculatePowerScore(description) {
                let score = 0;
                this.powerKeywords.forEach(keyword => {
                    if (description.includes(keyword)) {
                        score += 0.1;
                    }
                });
                return Math.min(1, score);
            }
            
            calculateFakeSceneScore(description) {
                let score = 0;
                this.fakeSceneMarkers.forEach(marker => {
                    if (description.includes(marker)) {
                        score += 0.2;
                    }
                });
                return Math.min(1, score);
            }
            
            calculateAuthenticSceneScore(description) {
                let score = 0;
                this.authenticSceneMarkers.forEach(marker => {
                    if (description.includes(marker)) {
                        score += 0.1;
                    }
                });
                return Math.min(1, score);
            }
            
            calculateArtificialBackgroundScore(description) {
                let score = 0;
                this.artificialBackgroundMarkers.forEach(marker => {
                    if (description.includes(marker)) {
                        score += 0.3; // Heavy penalty for artificial backgrounds
                    }
                });
                return Math.min(1, score);
            }
            
            determinePriority(score) {
                if (score >= 0.7) return 'high';
                if (score >= 0.4) return 'medium';
                return 'low';
            }
            
            generateTags(description) {
                const tags = [];
                
                // Executive tags
                this.executiveKeywords.forEach(keyword => {
                    if (description.includes(keyword)) {
                        tags.push(`executive-${keyword}`);
                    }
                });
                
                // Vintage tags
                this.vintageKeywords.forEach(keyword => {
                    if (description.includes(keyword)) {
                        tags.push(`vintage-${keyword}`);
                    }
                });
                
                // Power tags
                this.powerKeywords.forEach(keyword => {
                    if (description.includes(keyword)) {
                        tags.push(`power-${keyword}`);
                    }
                });
                
                // Scene authenticity tags
                this.authenticSceneMarkers.forEach(marker => {
                    if (description.includes(marker)) {
                        tags.push(`authentic-${marker}`);
                    }
                });
                
                return tags.slice(0, 5); // Limit to 5 tags
            }
        }

        // Initialize AI
        const ai = new ExecutiveAI();

        // Update slider values display
        document.getElementById('executiveScore').addEventListener('input', function() {
            document.getElementById('executiveValue').textContent = this.value + '%';
        });

        document.getElementById('vintageScore').addEventListener('input', function() {
            document.getElementById('vintageValue').textContent = this.value + '%';
        });

        document.getElementById('powerScore').addEventListener('input', function() {
            document.getElementById('powerValue').textContent = this.value + '%';
        });

        document.getElementById('sceneryScore').addEventListener('input', function() {
            document.getElementById('sceneryValue').textContent = this.value + '%';
        });

        document.getElementById('artificialScore').addEventListener('input', function() {
            document.getElementById('artificialValue').textContent = this.value + '%';
        });

        // Search functionality
        function searchImages() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;
            
            currentQuery = query;
            currentPage = 1;
            totalImages = 0;
            
            document.getElementById('masonryGrid').innerHTML = '';
            document.getElementById('loadMoreBtn').style.display = 'none';
            
            performSearch();
        }

        function searchSuggestion(query) {
            document.getElementById('searchInput').value = query;
            searchImages();
        }

        function loadMoreImages() {
            if (!isLoading && currentQuery) {
                currentPage++;
                performSearch();
            }
        }

        async function performSearch() {
            if (isLoading) return;
            
            isLoading = true;
            showStatus('loading', `üîç Searching for "${currentQuery}"... AI is analyzing images from Pexels, Unsplash & Reddit...`);
            
            try {
                const [pexelsResults, unsplashResults, redditResults] = await Promise.all([
                    searchPexels(currentQuery, currentPage),
                    searchUnsplash(currentQuery, currentPage),
                    searchReddit(currentQuery, currentPage)
                ]);
                
                let allImages = [];
                
                // Process Pexels results
                if (pexelsResults && pexelsResults.photos) {
                    const pexelsProcessed = pexelsResults.photos.map(photo => {
                        const analysis = ai.analyzeImage(photo, 'pexels');
                        if (!analysis) return null; // Filtered out by AI
                        
                        return {
                            id: `pexels-${photo.id}`,
                            url: photo.src.medium,
                            title: photo.alt || 'Untitled',
                            author: photo.photographer,
                            authorUrl: photo.photographer_url,
                            source: 'pexels',
                            analysis
                        };
                    }).filter(Boolean);
                    
                    allImages = allImages.concat(pexelsProcessed);
                }
                
                // Process Unsplash results
                if (unsplashResults && unsplashResults.results) {
                    const unsplashProcessed = unsplashResults.results.map(photo => {
                        const analysis = ai.analyzeImage(photo, 'unsplash');
                        if (!analysis) return null; // Filtered out by AI
                        
                        return {
                            id: `unsplash-${photo.id}`,
                            url: photo.urls.regular,
                            title: photo.alt_description || photo.description || 'Untitled',
                            author: photo.user.name,
                            authorUrl: photo.user.links.html,
                            source: 'unsplash',
                            analysis
                        };
                    }).filter(Boolean);
                    
                    allImages = allImages.concat(unsplashProcessed);
                }
                
                // Process Reddit results
                if (redditResults && redditResults.length > 0) {
                    const redditProcessed = redditResults.map(post => {
                        const analysis = ai.analyzeImage(post, 'reddit');
                        if (!analysis) return null; // Filtered out by AI
                        
                        return {
                            id: `reddit-${post.id}`,
                            url: post.url,
                            title: post.title || 'Untitled',
                            author: post.author,
                            authorUrl: `https://reddit.com/u/${post.author}`,
                            source: 'reddit',
                            analysis
                        };
                    }).filter(Boolean);
                    
                    allImages = allImages.concat(redditProcessed);
                }
                
                // Sort by AI score (highest first)
                allImages.sort((a, b) => b.analysis.finalScore - a.analysis.finalScore);
                
                if (allImages.length === 0) {
                    showStatus('error', '‚ùå No suitable images found. AI filtered out all results or no results available.');
                    return;
                }
                
                // Display images
                displayImages(allImages);
                totalImages += allImages.length;
                
                showStatus('success', `‚úÖ Found ${allImages.length} AI-analyzed images (Total: ${totalImages})`);
                updateImageCounter();
                
                // Show load more button
                document.getElementById('loadMoreBtn').style.display = 'block';
                
            } catch (error) {
                console.error('Search error:', error);
                showStatus('error', '‚ùå Search failed. Please try again.');
            } finally {
                isLoading = false;
            }
        }

        async function searchPexels(query, page) {
            try {
                const response = await fetch(`${PEXELS_API_URL}?query=${encodeURIComponent(query)}&page=${page}&per_page=20`, {
                    headers: {
                        'Authorization': PEXELS_API_KEY
                    }
                });
                return await response.json();
            } catch (error) {
                console.error('Pexels API error:', error);
                return null;
            }
        }

        async function searchUnsplash(query, page) {
            try {
                const response = await fetch(`${UNSPLASH_API_URL}?query=${encodeURIComponent(query)}&page=${page}&per_page=20`, {
                    headers: {
                        'Authorization': `Client-ID ${UNSPLASH_ACCESS_KEY}`
                    }
                });
                return await response.json();
            } catch (error) {
                console.error('Unsplash API error:', error);
                return null;
            }
        }

        async function searchReddit(query, page) {
            try {
                const promises = REDDIT_SUBREDDITS.map(subredditUrl => 
                    fetch(`${subredditUrl}?q=${encodeURIComponent(query)}&limit=25&sort=new&restrict_sr=on`)
                        .then(response => response.json())
                        .catch(err => {
                            console.error(`Error fetching from ${subredditUrl}:`, err);
                            return null;
                        })
                );
                
                const results = await Promise.all(promises);
                let allPosts = [];
                
                results.forEach(result => {
                    if (result && result.data && result.data.children) {
                        const posts = result.data.children
                            .map(child => child.data)
                            .filter(post => {
                                // Only include posts with images
                                const url = post.url;
                                return url && (
                                    url.includes('.jpg') || url.includes('.jpeg') || 
                                    url.includes('.png') || url.includes('.gif') ||
                                    url.includes('i.redd.it') || url.includes('i.imgur.com')
                                );
                            });
                        allPosts = allPosts.concat(posts);
                    }
                });
                
                return allPosts;
            } catch (error) {
                console.error('Reddit API error:', error);
                return [];
            }
        }

        function displayImages(images) {
            const grid = document.getElementById('masonryGrid');
            
            images.forEach(image => {
                const card = createImageCard(image);
                grid.appendChild(card);
            });
        }

        function createImageCard(image) {
            const card = document.createElement('div');
            card.className = `pin-card ${image.analysis.priority}-priority`;
            
            const scoreClass = image.analysis.priority;
            const scoreText = Math.round(image.analysis.finalScore * 100);
            
            card.innerHTML = `
                <img src="${image.url}" alt="${image.title}" class="pin-image" loading="lazy">
                <div class="pin-info">
                    <div class="pin-title">${image.title}</div>
                    <div class="pin-author">
                        üì∏ <a href="${image.authorUrl}" target="_blank">${image.author}</a>
                    </div>
                </div>
            `;
            
            return card;
        }

        function showStatus(type, message) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.className = `status ${type}`;
            statusEl.innerHTML = type === 'loading' ? `<div class="loading-spinner"></div>${message}` : message;
            statusEl.style.display = 'block';
            
            if (type !== 'loading') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 5000);
            }
        }

        function updateImageCounter() {
            const counterEl = document.getElementById('imageCounter');
            counterEl.textContent = `üìä Displaying ${totalImages} AI-analyzed images`;
            counterEl.style.display = 'block';
        }

        // Enter key search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchImages();
            }
        });

        // Initial load message
        showStatus('success', 'üöÄ Ready to search! AI will prioritize executive, vintage, powerful imagery with authentic scenes.');
    </script>
</body>
</html>

